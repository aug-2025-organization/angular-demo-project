<div class="container">
  <form [formGroup]="myReactiveForm" (ngSubmit)="handleFormSubmit()">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h3>EDIT BOOK</h3>
      </div>
      <div class="card-body">
        <div class="my-3">
          <label for="bTitle" class="form-label">Book Title:</label>
          <input
            type="text"
            class="form-control"
            id="bTitle"
            formControlName="bookTitle"
          />
          @if(myReactiveForm.get('bookTitle')?.invalid){
          @if(myReactiveForm.get('bookTitle')?.errors?.['required']){
          <div class="text-danger text-small">Book Title is required!</div>
          } @if(myReactiveForm.get('bookTitle')?.errors?.['minlength']){
          <div class="text-danger text-small">
            Book Title should be atleast 2 characters in length!
          </div>
          } }
        </div>
        <div class="mb-3">
          <label for="bAuthor" class="form-label">Book Author:</label>
          <select class="form-control" id="bAuthor" formControlName="author">
            <option [ngValue]="null">--select--</option>
            @for(eachAuthor of allAuthors; track $index){
            <option
              [ngValue]="eachAuthor"
              [selected]="eachAuthor.authorId==myReactiveForm.get('author')?.get('authorId')?.value"
            >
              {{ eachAuthor.authorFirstname }} {{ eachAuthor.authorLastname }}
              {{eachAuthor.authorId==myReactiveForm.get('author')?.get('authorId')?.value}}
            </option>

            }
          </select>
        </div>
        <div class="mb-3">
          <label for="bCategory" class="form-label">Book Category:</label>
          <select
            class="form-control"
            id="bCategory"
            formControlName="bookCategory"
          >
            <option value="Fantasy">Fantasy</option>
            <option value="Thriller">Thriller</option>
            <option value="Comedy">Comedy</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="bPublished" class="form-label">Book Published:</label>
          <input
            type="date"
            class="form-control"
            id="bPublished"
            formControlName="bookPublished"
          />
        </div>
        <div class="mb-3">
          <label for="bPrice" class="form-label">Book Price:</label>
          <input
            type="text"
            class="form-control"
            id="bPrice"
            formControlName="bookPrice"
          />
          @if(myReactiveForm.get('bookPrice')?.invalid){
          <div class="text-danger text-small">Book Price is required!</div>
          }
        </div>
        <div class="mb-3">
          <label for="bImage" class="form-label">Book Image Url:</label>
          <input
            type="text"
            class="form-control"
            id="bImage"
            formControlName="bookImageUrl"
          />
        </div>

        <div class="mb-3">
          <label for="bAuthor" class="form-label">Book Character:</label>
          <select
            class="form-control"
            id="bCharacter"
            formControlName="eachSelChar"
          >
            @for(eachCharacter of allCharacters; track $index){
            <option [ngValue]="eachCharacter">
              {{ eachCharacter.characterFirstname }} {{
              eachCharacter.characterLastname }}
            </option>
            }
          </select>
          <div class="d-grid">
            <button
              type="button"
              class="btn btn-primary btn-block my-2"
              (click)="addCharacter()"
            >
              +
            </button>
          </div>

          <table class="table table-striped">
            <tbody>
              @for(eachChar of selectedCharacters; track $index){
              <tr>
                <td>{{ eachChar.characterId }}</td>
                <td>{{ eachChar.characterFirstname }}</td>
                <td>{{ eachChar.characterLastname }}</td>
                <td>
                  <button
                    type="button"
                    class="btn btn-danger btn-small"
                    (click)="removeChar(eachChar.characterId)"
                  >
                    X
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer bg-primary text-white">
        <button
          type="submit"
          class="btn btn-light text-primary mx-2"
          [disabled]="myReactiveForm.invalid"
        >
          UPDATE
        </button>
        <button type="reset" class="btn btn-light text-primary mx-2">
          CLEAR
        </button>
      </div>
    </div>
  </form>
</div>
