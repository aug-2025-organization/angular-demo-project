<div class="container">
  <form (ngSubmit)="handleFormSubmit()" #tempForm="ngForm">
    <div class="card">
      <div class="card-header bg-success text-white">
        <h3>ADD A NEW BOOK HTTP</h3>
      </div>
      <div class="card-body">
        <div class="my-3">
          <label for="bTitle" class="form-label">Book Title:</label>
          <input
            type="text"
            class="form-control"
            id="bTitle"
            name="bookTitle"
            [(ngModel)]="newBook.bookTitle"
            required
            minlength="2"
            maxlength="100"
            #tempTitle="ngModel"
            (change)="displayTempTitle(tempTitle)"
          />
          @if(tempTitle.invalid && tempTitle.touched){ @if(tempTitle.errors !=
          null && tempTitle.errors['minlength']){
          <div class="text-danger text-small">
            Book Title should be atleast 2 characters!
          </div>
          } @if(tempTitle.errors != null && tempTitle.errors['required']){
          <div class="text-danger text-small">Book Title is required!</div>
          } }
        </div>
        <div class="mb-3">
          <label for="bAuthor" class="form-label">Book Author:</label>
          <select
            class="form-control"
            id="bAuthor"
            name="bookAuthor"
            [(ngModel)]="newBook.author"
            required
          >
            @for(eachAuthor of allAuthors; track $index){
            <option [ngValue]="eachAuthor">
              {{ eachAuthor.authorFirstname }} {{ eachAuthor.authorLastname }}
            </option>
            }
          </select>
        </div>
        <div class="mb-3">
          <label for="bCategory" class="form-label">Book Category:</label>
          <select
            class="form-control"
            id="bCategory"
            name="bookCategory"
            [(ngModel)]="newBook.bookCategory"
            required
          >
            <option value="Fantasy">Fantasy</option>
            <option value="Thriller">Thriller</option>
            <option value="Comedy">Comedy</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="bPublished" class="form-label">Book Published:</label>
          <input
            type="date"
            class="form-control"
            id="bPublished"
            name="bookPublished"
            [(ngModel)]="newBook.bookPublished"
            #tempPublished="ngModel"
            required
          />
        </div>
        @if(tempPublished.invalid && tempPublished.touched){
        <div class="text-danger text-small">Book Publish Date is required!</div>
        }
        <div class="mb-3">
          <label for="bPrice" class="form-label">Book Price:</label>
          <input
            type="text"
            class="form-control"
            id="bPrice"
            name="bookPrice"
            [(ngModel)]="newBook.bookPrice"
            #tempPrice="ngModel"
            required
          />
          @if(tempPrice.invalid && tempPrice.touched){
          <div class="text-danger text-small">Book Price is required!</div>
          }
        </div>
        <div class="mb-3">
          <label for="bImage" class="form-label">Book Image Url:</label>
          <input
            type="text"
            class="form-control"
            id="bImage"
            name="bookImage"
            [(ngModel)]="newBook.bookImageUrl"
          />
        </div>

        <div class="mb-3">
          <label for="bAuthor" class="form-label">Book Character:</label>
          <select
            class="form-control"
            id="bCharacter"
            name="bookCharacter"
            [(ngModel)]="selectedCharacterId"
          >
            @for(eachCharacter of allCharacters; track $index){
            <option value="{{ eachCharacter.characterId }}">
              {{ eachCharacter.characterFirstname }} {{
              eachCharacter.characterLastname }}
            </option>
            }
          </select>
          <div class="d-grid">
            <button
              type="button"
              class="btn btn-success btn-block my-2"
              (click)="addCharacter()"
            >
              +
            </button>
          </div>

          <table class="table table-striped">
            <tbody>
              @for(eachChar of selectedCharacters; track $index){
              <tr>
                <td>{{ eachChar.characterId }}</td>
                <td>{{ eachChar.characterFirstname }}</td>
                <td>{{ eachChar.characterLastname }}</td>
                <td>
                  <button
                    type="button"
                    class="btn btn-danger btn-small"
                    (click)="removeChar(eachChar.characterId)"
                  >
                    X
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer bg-success text-white">
        <button
          type="submit"
          class="btn btn-light text-success mx-2"
          [disabled]="tempForm.invalid"
        >
          ADD
        </button>
        <button type="reset" class="btn btn-light text-success mx-2">
          CLEAR
        </button>
      </div>
    </div>
  </form>
</div>
